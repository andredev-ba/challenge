import{r as V,y as v,B as X,aj as J,aa as Y,at as ee,z as D,x as te,a3 as ae,ab as le,a4 as oe,a6 as ie,ac as ne,aN as re,ad as W,Z as se,a5 as ue,ah as ce,d as de,u as me,a as fe,c as ve,o as pe,W as ge,e as L,f as xe,w as M,g as b,h as k,i as q,aO as ye,p as he,n as be,Q as K,m as Fe,q as Ve}from"./index.e5ec3fee.js";import{b as Ce,Q as Ee}from"./QSelect.5c5caa48.js";import{Q as Se}from"./QImg.db652b52.js";import{h as _e}from"./format.53708e68.js";import{P as Q}from"./ProductService.49521e52.js";import{u as Pe}from"./use-quasar.2a01554d.js";function N(e,c,C,g){const i=[];return e.forEach(l=>{g(l)===!0?i.push(l):c.push({failedPropValidation:C,file:l})}),i}function w(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),Y(e)}const ze={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},ke=["rejected"];function De({editable:e,dnd:c,getFileInput:C,addFilesToQueue:g}){const{props:i,emit:l,proxy:x}=X(),y=V(null),E=v(()=>i.accept!==void 0?i.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),S=v(()=>parseInt(i.maxFiles,10)),_=v(()=>parseInt(i.maxTotalSize,10));function P(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&J(t);else{const m=C();m&&m!==t.target&&m.click(t)}}function F(t){e.value&&t&&g(null,t)}function O(t,m,u,n){let a=Array.from(m||t.target.files);const p=[],z=()=>{p.length!==0&&l("rejected",p)};if(i.accept!==void 0&&E.value.indexOf("*/")===-1&&(a=N(a,p,"accept",r=>E.value.some(d=>r.type.toUpperCase().startsWith(d)||r.name.toUpperCase().endsWith(d))),a.length===0))return z();if(i.maxFileSize!==void 0){const r=parseInt(i.maxFileSize,10);if(a=N(a,p,"max-file-size",d=>d.size<=r),a.length===0)return z()}if(i.multiple!==!0&&a.length!==0&&(a=[a[0]]),a.forEach(r=>{r.__key=r.webkitRelativePath+r.lastModified+r.name+r.size}),n===!0){const r=u.map(d=>d.__key);a=N(a,p,"duplicate",d=>r.includes(d.__key)===!1)}if(a.length===0)return z();if(i.maxTotalSize!==void 0){let r=n===!0?u.reduce((d,T)=>d+T.size,0):0;if(a=N(a,p,"max-total-size",d=>(r+=d.size,r<=_.value)),a.length===0)return z()}if(typeof i.filter=="function"){const r=i.filter(a);a=N(a,p,"filter",d=>r.includes(d))}if(i.maxFiles!==void 0){let r=n===!0?u.length:0;if(a=N(a,p,"max-files",()=>(r++,r<=S.value)),a.length===0)return z()}if(z(),a.length!==0)return a}function j(t){w(t),c.value!==!0&&(c.value=!0)}function s(t){Y(t),(t.relatedTarget!==null||ee.is.safari!==!0?t.relatedTarget!==y.value:document.elementsFromPoint(t.clientX,t.clientY).includes(y.value)===!1)===!0&&(c.value=!1)}function I(t){w(t);const m=t.dataTransfer.files;m.length!==0&&g(null,m),c.value=!1}function R(t){if(c.value===!0)return D("div",{ref:y,class:`q-${t}__dnd absolute-full`,onDragenter:w,onDragover:w,onDragleave:s,onDrop:I})}return Object.assign(x,{pickFiles:P,addFiles:F}),{pickFiles:P,addFiles:F,onDragover:j,onDragleave:s,processFiles:O,getDndNode:R,maxFilesNumber:S,maxTotalSizeNumber:_}}var Ie=te({name:"QFile",inheritAttrs:!1,props:{...ae,...le,...ze,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...oe,...ke],setup(e,{slots:c,emit:C,attrs:g}){const{proxy:i}=X(),l=ie(),x=V(null),y=V(!1),E=ne(e),{pickFiles:S,onDragover:_,onDragleave:P,processFiles:F,getDndNode:O}=De({editable:l.editable,dnd:y,getFileInput:B,addFilesToQueue:$}),j=re(e),s=v(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),I=v(()=>W(s.value)),R=v(()=>s.value.map(o=>o.name).join(", ")),t=v(()=>_e(s.value.reduce((o,f)=>o+f.size,0))),m=v(()=>({totalSize:t.value,filesNumber:s.value.length,maxFiles:e.maxFiles})),u=v(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:E.value,...g,id:l.targetUid.value,disabled:l.editable.value!==!0})),n=v(()=>"q-file q-field--auto-height"+(y.value===!0?" q-file--dnd":"")),a=v(()=>e.multiple===!0&&e.append===!0);function p(o){const f=s.value.slice();f.splice(o,1),r(f)}function z(o){const f=s.value.indexOf(o);f>-1&&p(f)}function r(o){C("update:modelValue",e.multiple===!0?o:o[0])}function d(o){o.keyCode===13&&ce(o)}function T(o){(o.keyCode===13||o.keyCode===32)&&S(o)}function B(){return x.value}function $(o,f){const h=F(o,f,s.value,a.value),U=B();U!=null&&(U.value=""),h!==void 0&&((e.multiple===!0?e.modelValue&&h.every(H=>s.value.includes(H)):e.modelValue===h[0])||r(a.value===!0?s.value.concat(h):h))}function A(){return[D("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function Z(){if(c.file!==void 0)return s.value.length===0?A():s.value.map((f,h)=>c.file({index:h,file:f,ref:this}));if(c.selected!==void 0)return s.value.length===0?A():c.selected({files:s.value,ref:this});if(e.useChips===!0)return s.value.length===0?A():s.value.map((f,h)=>D(Ce,{key:"file-"+h,removable:l.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{p(h)}},()=>D("span",{class:"ellipsis",textContent:f.name})));const o=e.displayValue!==void 0?e.displayValue:R.value;return o.length!==0?[D("div",{class:e.inputClass,style:e.inputStyle,textContent:o})]:A()}function G(){const o={ref:x,...u.value,...j.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:$};return e.multiple===!0&&(o.multiple=!0),D("input",o)}return Object.assign(l,{fieldClass:n,emitValue:r,hasValue:I,inputRef:x,innerValue:s,floatingLabel:v(()=>I.value===!0||W(e.displayValue)),computedCounter:v(()=>{if(e.counterLabel!==void 0)return e.counterLabel(m.value);const o=e.maxFiles;return`${s.value.length}${o!==void 0?" / "+o:""} (${t.value})`}),getControlChild:()=>O("file"),getControl:()=>{const o={ref:l.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return l.editable.value===!0&&Object.assign(o,{onDragover:_,onDragleave:P,onKeydown:d,onKeyup:T}),D("div",o,[G()].concat(Z()))}}),Object.assign(i,{removeAtIndex:p,removeFile:z,getNativeElement:()=>x.value}),se(i,"nativeEl",()=>x.value),ue(l)}});const Ne={class:"col-12 col-sm-6"},Oe={class:"col-12 col-sm-2"},je={class:"col-12 col-sm-2"},Re={class:"col-12 col-sm-2"},Ae={class:"col-12"},qe={class:"col-12"},Qe={key:0},we={class:"col-12"},Te={class:"col-12 col-sm-3"},Ke=de({__name:"FormComponent",props:["action"],setup(e){const c=e,C=me(),g=fe(),i=Pe(),l=ve({name:"",description:"",price:0,expirationDate:"",imageFile:[],categoryId:""}),x=V(""),y=V([]),E=V(null),S=V(null),_=V(null),P=V(null),F=[u=>!!u||"Este campo \xE9 obrigat\xF3rio"];pe(()=>{I()});function O(){m()&&(c.action=="add"?j():s())}async function j(){(await Q.addProduct(l)).status==201?(i.notify({color:"positive",message:"Produto adicionado com sucesso!"}),g.push("/produtos")):i.dialog({title:"Erro na Solicita\xE7\xE3o",message:"Ocorreu um erro ao adicionar a produto. Por favor, tente novamente.",color:"negative",persistent:!0})}async function s(){const u=C.params.uuid;(await Q.updateProduct(l,u)).status==200?(i.notify({color:"positive",message:"Produto atualizado com sucesso!"}),g.push("/produtos")):i.dialog({title:"Erro na Solicita\xE7\xE3o",message:"Ocorreu um erro ao atualizar a produto. Por favor, tente novamente.",color:"negative",persistent:!0})}function I(){if(c.action=="edit"){const u=C.params.uuid;R(u)}else t()}async function R(u){const n=await Q.editProduct(u);n.status==200?(y.value=n.data.options.categories,await ge(),Object.assign(l,n.data||{}),x.value=n.data.imageUrl):(i.dialog({title:"Erro na Solicita\xE7\xE3o",message:"Ocorreu um erro ao carregar dados para edi\xE7\xE3o do produto. Por favor, tente novamente.",color:"negative",persistent:!0}),g.push("/produtos"))}async function t(){const u=await Q.createProduct();u.status==200?(Object.assign(l,u.data||{}),y.value=u.data.options.categories):(i.dialog({title:"Erro na Solicita\xE7\xE3o",message:"Ocorreu um erro ao carregar dados para cria\xE7\xE3o do produto. Por favor, tente novamente.",color:"negative",persistent:!0}),g.push("/produtos"))}function m(){return E.value.validate(),S.value.validate(),_.value.validate(),P.value.validate(),E.value.hasError||S.value.hasError||_.value.hasError||P.value.hasError?(i.notify({color:"negative",message:"Preencha os campos obrigat\xF3rios"}),!1):!0}return(u,n)=>(L(),xe(Ve,{flat:"",class:"q-pa-sm"},{default:M(()=>[b(Fe,{class:"row q-col-gutter-md"},{default:M(()=>[k("div",Ne,[b(q,{ref_key:"nameRef",ref:E,rules:F,modelValue:l.name,"onUpdate:modelValue":n[0]||(n[0]=a=>l.name=a),dense:"",outlined:"","lazy-rules":"",label:"Nome do produto *"},null,8,["modelValue"])]),k("div",Oe,[b(q,{ref_key:"priceRef",ref:S,rules:F,modelValue:l.price,"onUpdate:modelValue":n[1]||(n[1]=a=>l.price=a),dense:"",outlined:"","lazy-rules":"",label:"Pre\xE7o *",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"])]),k("div",je,[b(q,{type:"date",ref_key:"expirationDateRef",ref:_,rules:F,modelValue:l.expirationDate,"onUpdate:modelValue":n[2]||(n[2]=a=>l.expirationDate=a),dense:"",outlined:"","lazy-rules":"",label:"Data de validade *"},null,8,["modelValue"])]),k("div",Re,[b(Ee,{ref_key:"categoryIdRef",ref:P,rules:F,options:y.value,modelValue:l.categoryId,"onUpdate:modelValue":n[3]||(n[3]=a=>l.categoryId=a),dense:"",outlined:"","lazy-rules":"","emit-value":"","map-options":"",label:"Produto *"},null,8,["options","modelValue"])]),k("div",Ae,[b(q,{type:"textarea",dense:"",outlined:"",label:"Descri\xE7\xE3o",modelValue:l.description,"onUpdate:modelValue":n[4]||(n[4]=a=>l.description=a)},null,8,["modelValue"])]),k("div",qe,[l.imageFile.length==0?(L(),ye("div",Qe,[he(" Imagem atual: "),b(Se,{style:{width:"50px",heigth:"50px"},src:x.value},null,8,["src"])])):be("",!0)]),k("div",we,[b(Ie,{modelValue:l.imageFile,"onUpdate:modelValue":n[5]||(n[5]=a=>l.imageFile=a),dense:"",outlined:"",label:c.action=="add"?"Imagem do produto":"Trocar imagem"},null,8,["modelValue","label"])]),k("div",Te,[b(K,{onClick:O,"no-caps":"",icon:"fa-solid fa-save",color:"positive",label:c.action=="add"?"Cadastrar":"Atualizar"},null,8,["label"]),b(K,{"no-caps":"",class:"q-ml-sm",icon:"fa-solid fa-close",color:"negative",label:"Cancelar",onClick:n[6]||(n[6]=a=>u.$router.push("/produtos"))})])]),_:1})]),_:1}))}});export{Ke as _};
